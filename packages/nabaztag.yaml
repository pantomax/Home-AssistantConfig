###############################################################################
#
#                                 NABAZTAG PACKAGE
#
###############################################################################
#------------------------------------------------------------------------------
sensor:
#------------------------------------------------------------------------------
# Traffic Sensor - Google Distance Matrix Api Key
# {{ states.sensor.home_to_work.attributes.status }}
  - platform: google_travel_time
    api_key: !secret google_distance_matrix_api_key
    name: Home To Work
    origin: Verona, Italy
    destination: Modena, Italy
    options:
      mode: driving
      units: metric
  - platform: template
    sensors:
      traffic_status:
        value_template: >-
          {{ states.sensor.home_to_work.attributes.status }}
# Bitcoin Sensor
# {{ states('sensor.exchange_rate_1_btc') }}
  - platform: bitcoin
    display_options:
      - exchangerate
      - timestamp
# AirVisual Sensor
# {{ states('sensor.us_air_quality_index') }}
  - platform: airvisual
    api_key: !secret airvisual_api_key
    monitored_conditions:
      - us
    latitude: !secret airvisual_latitude
    longitude: !secret airvisual_longitude
    radius: 1000
    show_on_map: false
# Meteo Darksky
#{{ states('sensor.dark_sky_icon') }}
  - platform: darksky
    api_key: !secret secret_darksky_api_key
    update_interval: 300
    monitored_conditions:
      - icon
#------------------------------------------------------------------------------
group:
#------------------------------------------------------------------------------
  nabaztag_body:
    name: Nabaztag Body
    control: hidden
    entities:
      - switch.nabaztag_taichi
      - input_select.nabaztag_taichi
      - switch.nabaztag_nose
      - input_select.nabaztag_nose
      - input_number.nabaztag_left_ear
      - input_number.nabaztag_right_ear
      - input_select.nabaztag_body_language
  nabaztag_lights:
    name: Nabaztag Info
    control: hidden
    entities:
      - input_select.nabaztag_show_info
      - input_select.nabaztag_weather
      - input_select.nabaztag_stocks
      - input_select.nabaztag_traffic
      - input_select.nabaztag_pollution
      - script.nabaztag_info_off
  nabaztag_utils:
    name: Nabaztag Utils
    control: hidden
    entities:
      - switch.nabaztaglife
      - script.nabaztag_surprise
      - script.nabaztag_stop
      - input_select.nabaztag_sounds
      - input_select.nabaztag_radio
      - input_text.nabaztag_voice
      - input_boolean.show_nabaztag_locales
  nabaztag_locale_setup:
    name: Nabaztag Locales
    control: hidden
    entities:
      - input_select.nabaztag_language
      - input_select.nabaztag_time_zone
      - script.nabaztag_update
      - script.nabaztag_reboot
#------------------------------------------------------------------------------
input_boolean:
#------------------------------------------------------------------------------
  show_nabaztag_locales:
    name: Locales Setup
    initial: off
    icon: mdi:tune
#------------------------------------------------------------------------------
input_number:
#------------------------------------------------------------------------------
  nabaztag_left_ear:
    icon: mdi:ear-hearing
    name: Left Ear
    initial: 0
    min: 0
    max: 16
    step: 1
  nabaztag_right_ear:
    icon: mdi:ear-hearing
    name: Right Ear
    initial: 0
    min: 0
    max: 16
    step: 1
  bitcoin_previous_exchange_rate:
    mode: box
    icon: mdi:currency-btc
    name: Previous Bitcoin Exchange Rate
    initial: 0
    min: 0
    max: 100000
    step: 0.01
  bitcoin_value_difference:
    mode: box
    icon: mdi:currency-btc
    name: Bitcoin Value Difference
    initial: 0
    min: -100000
    max: 100000
    step: 0.01
#------------------------------------------------------------------------------
input_text:
#------------------------------------------------------------------------------
  nabaztag_voice:
    name: TTS
    initial: Say Something...
    min: 1
    max: 200
    pattern: '[a-fA-F0-9]*'
#------------------------------------------------------------------------------
script:
#------------------------------------------------------------------------------
  nabaztag_talk:
    alias: Nabaztag talk
    sequence:
      - alias: Nabaztag Google TTS
        service: tts.google_say
        entity_id: media_player.nabaztag
        data_template: 
          message: >
            '{{ message }}'
          language: 'it'
          cache: True
      - alias: Call bash script with curl command
        service: shell_command.nab_talk
      - alias: Clearing Google TTS
        service: tts.clear_cache
#******************************************************************************
  nabaztag_surprise:
    alias: Talk!
    sequence:
      - service: shell_command.nab_surprise
#******************************************************************************
  nabaztag_stop:
    alias: Shut Up!
    sequence:
      - service: shell_command.nab_stop
#******************************************************************************
  nabaztag_info_off:
    alias: Info Off
    sequence:
      - service: shell_command.nab_clear
#******************************************************************************
  nabaztag_update:
    alias: Sync Time
    sequence:
      - service: shell_command.nab_gettime
#******************************************************************************
  nabaztag_reboot:
    alias: Reboot
    sequence:
      - service: shell_command.nab_reboot
#------------------------------------------------------------------------------
switch:
#------------------------------------------------------------------------------
  platform: command_line
  switches:
    nabaztaglife:
      command_on: "curl http://192.168.1.180/wakeup"
      command_off: "curl http://192.168.1.180/sleep"
      friendly_name: Nabaztag Switch
    nabaztag_taichi:
      command_on: "curl http://192.168.1.180/taichi?v=1000"
      command_off: "curl http://192.168.1.180/taichi?v=0"
      friendly_name: Let's Taichi
    nabaztag_nose:
      command_on: "curl http://192.168.1.180/nose?v=1"
      command_off: "curl http://192.168.1.180/nose?v=0"
      friendly_name: Nose
#------------------------------------------------------------------------------
media_player:
#------------------------------------------------------------------------------
  - platform: universal
    name: nabaztag
#------------------------------------------------------------------------------
input_select:
#------------------------------------------------------------------------------
  nabaztag_taichi:
    name: Taichi Intensity
    options:
      - " "
      - "Taichi min"
      - "Taichi medium"
      - "Taichi max"
    initial: " "
    icon: mdi:nintendo-switch
  nabaztag_nose:
    name: Nose Speed
    options:
      - " "
      - "Todo"
      - "Urgent"
      - "Panic"
    initial: " "
    icon: mdi:star-circle
  nabaztag_weather:
    name: Weather
    options:
      - " "
      - "Sun"
      - "Clouds"
      - "Fog"
      - "Rain"
      - "Snow"
      - "Storm"
    initial: " "
    icon: mdi:weather-partlycloudy
  nabaztag_stocks:
    name: Stocks
    options:
      - " "
      - "---"
      - "--"
      - "-"
      - "0"
      - "+"
      - "++"
      - "+++"
    initial: " "
    icon: mdi:currency-btc
  nabaztag_traffic:
    name: Traffic
    options:
      - " "
      - "Free"
      - "Okay"
      - "Moderate"
      - "Normal"
      - "Heavy"
      - "Congested"
      - "Extreme"
    initial: " "
    icon: mdi:traffic-light
  nabaztag_pollution:
    name: Pollution
    options:
      - " "
      - 0
      - 1
      - 2
      - 3
      - 4
      - 5
      - 6
      - 7
      - 8
      - 9
      - 10
    initial: " "
    icon: mdi:factory
  nabaztag_sounds:
    name: Sounds
    options:
      - " "
      - "Communication"
      - "Ack"
      - "Abort"
      - "Ministop"
    initial: " "
    icon: mdi:voice
  nabaztag_radio:
    name: Radio Station
    options:
      - " "
      - Radio 1
      - Radio 2
      - Radio 3
      - No radio
    initial: " "
    icon: mdi:radio
  nabaztag_language:
    name: Language
    options:
      - " "
      - "English"
      - "Italian"
      - "French"
      - "Spanish"
    initial: " "
    icon: mdi:earth
  nabaztag_time_zone:
    name: Time Zone
    options:
      - "GMT -12:00"
      - "GMT -11:00"
      - "GMT -10:00"
      - "GMT -9:00"
      - "GMT -8:00"
      - "GMT -7:00"
      - "GMT -6:00"
      - "GMT -5:00"
      - "GMT -4:00"
      - "GMT -3:30"
      - "GMT -3:00"
      - "GMT -2:00"
      - "GMT -1:00"
      - "GMT"
      - "GMT +1:00"
      - "GMT +2:00"
      - "GMT +3:00"
      - "GMT +3:30"
      - "GMT +4:00"
      - "GMT +4:30"
      - "GMT +5:00"
      - "GMT +5:30"
      - "GMT +5:45"
      - "GMT +6:00"
      - "GMT +7:00"
      - "GMT +8:00"
      - "GMT +9:00"
      - "GMT +9:30"
      - "GMT +10:00"
      - "GMT +11:00"
      - "GMT +12:00"
    initial: "GMT"
    icon: mdi:clock
  nabaztag_body_language:
    name: Body Language
    options:
      - " "
      - "Listening"
      - "Curious"
      - "Crazy"
      - "Scared"
      - "Sad"
      - "Up"
      - "Down"
      - "Left"
      - "Right"
    initial: " "
    icon: mdi:heart-pulse
  nabaztag_show_info:
    name: Info to Show
    options:
      - " "
      - "Weather"
      - "Stocks"
      - "Traffic"
      - "Pollution"
    initial: "Weather"
    icon: mdi:format-list-bulleted-type
#------------------------------------------------------------------------------
shell_command:
#------------------------------------------------------------------------------
  nab_surprise: curl http://192.168.1.180/surprise
  nab_stop: curl http://192.168.1.180/stop
  nab_clear: curl http://192.168.1.180/clear
  nab_sleep: curl http://192.168.1.180/sleep
  nab_wakeup: curl http://192.168.1.180/wakeup
  nab_gettime: curl http://192.168.1.180/gettime
  nab_reboot: curl http://192.168.1.180/reboot
  nab_communication: curl http://192.168.1.180/communication
  nab_ack: curl http://192.168.1.180/ack
  nab_abort: curl http://192.168.1.180/abort
  nab_ministop: curl http://192.168.1.180/ministop
  nab_do_taichi_now: curl http://192.168.1.180/taichi?v=1000
  nab_taichi_off: curl http://192.168.1.180/taichi?v=0
  nab_taichi_min: curl http://192.168.1.180/taichi?v=40
  nab_taichi_medium: curl http://192.168.1.180/taichi?v=80
  nab_taichi_max: curl http://192.168.1.180/taichi?v=255
  nab_nose_0: curl http://192.168.1.180/nose?v=0
  nab_nose_1: curl http://192.168.1.180/nose?v=1
  nab_nose_2: curl http://192.168.1.180/nose?v=2
  nab_nose_3: curl http://192.168.1.180/nose?v=3
  nab_nose_4: curl http://192.168.1.180/nose?v=4
  nab_ear_left_0: curl http://192.168.1.180/left?p=0&d=0
  nab_ear_left_1: curl http://192.168.1.180/left?p=1&d=0
  nab_ear_left_2: curl http://192.168.1.180/left?p=2&d=0
  nab_ear_left_3: curl http://192.168.1.180/left?p=3&d=0
  nab_ear_left_4: curl http://192.168.1.180/left?p=4&d=0
  nab_ear_left_5: curl http://192.168.1.180/left?p=5&d=0
  nab_ear_left_6: curl http://192.168.1.180/left?p=6&d=0
  nab_ear_left_7: curl http://192.168.1.180/left?p=7&d=0
  nab_ear_left_8: curl http://192.168.1.180/left?p=8&d=0
  nab_ear_left_9: curl http://192.168.1.180/left?p=9&d=0
  nab_ear_left_10: curl http://192.168.1.180/left?p=10&d=0
  nab_ear_left_11: curl http://192.168.1.180/left?p=11&d=0
  nab_ear_left_12: curl http://192.168.1.180/left?p=12&d=0
  nab_ear_left_13: curl http://192.168.1.180/left?p=13&d=0
  nab_ear_left_14: curl http://192.168.1.180/left?p=14&d=0
  nab_ear_left_15: curl http://192.168.1.180/left?p=15&d=0
  nab_ear_left_16: curl http://192.168.1.180/left?p=16&d=0
  nab_ear_right_0: curl http://192.168.1.180/right?p=0&d=0
  nab_ear_right_1: curl http://192.168.1.180/right?p=1&d=0
  nab_ear_right_2: curl http://192.168.1.180/right?p=2&d=0
  nab_ear_right_3: curl http://192.168.1.180/right?p=3&d=0
  nab_ear_right_4: curl http://192.168.1.180/right?p=4&d=0
  nab_ear_right_5: curl http://192.168.1.180/right?p=5&d=0
  nab_ear_right_6: curl http://192.168.1.180/right?p=6&d=0
  nab_ear_right_7: curl http://192.168.1.180/right?p=7&d=0
  nab_ear_right_8: curl http://192.168.1.180/right?p=8&d=0
  nab_ear_right_9: curl http://192.168.1.180/right?p=9&d=0
  nab_ear_right_10: curl http://192.168.1.180/right?p=10&d=0
  nab_ear_right_11: curl http://192.168.1.180/right?p=11&d=0
  nab_ear_right_12: curl http://192.168.1.180/right?p=12&d=0
  nab_ear_right_13: curl http://192.168.1.180/right?p=13&d=0
  nab_ear_right_14: curl http://192.168.1.180/right?p=14&d=0
  nab_ear_right_15: curl http://192.168.1.180/right?p=15&d=0
  nab_ear_right_16: curl http://192.168.1.180/right?p=16&d=0
  nab_talk: bash /config/www/vl/voice/talk.sh
  nab_weather_0: curl http://192.168.1.180/weather?v=0
  nab_weather_1: curl http://192.168.1.180/weather?v=1
  nab_weather_2: curl http://192.168.1.180/weather?v=2
  nab_weather_3: curl http://192.168.1.180/weather?v=3
  nab_weather_4: curl http://192.168.1.180/weather?v=4
  nab_weather_5: curl http://192.168.1.180/weather?v=5
  nab_stock_0: curl http://192.168.1.180/stock?v=0
  nab_stock_1: curl http://192.168.1.180/stock?v=1
  nab_stock_2: curl http://192.168.1.180/stock?v=2
  nab_stock_3: curl http://192.168.1.180/stock?v=3
  nab_stock_4: curl http://192.168.1.180/stock?v=4
  nab_stock_5: curl http://192.168.1.180/stock?v=5
  nab_stock_6: curl http://192.168.1.180/stock?v=6
  nab_traffic_0: curl http://192.168.1.180/traffic?v=0
  nab_traffic_1: curl http://192.168.1.180/traffic?v=1
  nab_traffic_2: curl http://192.168.1.180/traffic?v=2
  nab_traffic_3: curl http://192.168.1.180/traffic?v=3
  nab_traffic_4: curl http://192.168.1.180/traffic?v=4
  nab_traffic_5: curl http://192.168.1.180/traffic?v=5
  nab_traffic_6: curl http://192.168.1.180/traffic?v=6
  nab_pollution_0: curl http://192.168.1.180/pollution?v=0
  nab_pollution_1: curl http://192.168.1.180/pollution?v=1
  nab_pollution_2: curl http://192.168.1.180/pollution?v=2
  nab_pollution_3: curl http://192.168.1.180/pollution?v=3
  nab_pollution_4: curl http://192.168.1.180/pollution?v=4
  nab_pollution_5: curl http://192.168.1.180/pollution?v=5
  nab_pollution_6: curl http://192.168.1.180/pollution?v=6
  nab_pollution_7: curl http://192.168.1.180/pollution?v=7
  nab_pollution_8: curl http://192.168.1.180/pollution?v=8
  nab_pollution_9: curl http://192.168.1.180/pollution?v=9
  nab_pollution_10: curl http://192.168.1.180/pollution?v=10
  nab_lang_uk: curl http://192.168.1.180/lang?v=uk
  nab_lang_it: curl http://192.168.1.180/lang?v=it
  nab_lang_fr: curl http://192.168.1.180/lang?v=fr
  nab_lang_es: curl http://192.168.1.180/lang?v=es
  nab_time_zone_b1200: curl http://192.168.1.180/time?v=-720
  nab_time_zone_b1100: curl http://192.168.1.180/time?v=-660
  nab_time_zone_b1000: curl http://192.168.1.180/time?v=-600
  nab_time_zone_b900: curl http://192.168.1.180/time?v=-540
  nab_time_zone_b800: curl http://192.168.1.180/time?v=-480
  nab_time_zone_b700: curl http://192.168.1.180/time?v=-420
  nab_time_zone_b600: curl http://192.168.1.180/time?v=-360
  nab_time_zone_b500: curl http://192.168.1.180/time?v=-300
  nab_time_zone_b400: curl http://192.168.1.180/time?v=-240
  nab_time_zone_b330: curl http://192.168.1.180/time?v=-210
  nab_time_zone_b300: curl http://192.168.1.180/time?v=-180
  nab_time_zone_b200: curl http://192.168.1.180/time?v=-120
  nab_time_zone_b100: curl http://192.168.1.180/time?v=-60
  nab_time_zone_0: curl http://192.168.1.180/time?v=0
  nab_time_zone_100: curl http://192.168.1.180/time?v=60
  nab_time_zone_200: curl http://192.168.1.180/time?v=120
  nab_time_zone_300: curl http://192.168.1.180/time?v=180
  nab_time_zone_330: curl http://192.168.1.180/time?v=210
  nab_time_zone_400: curl http://192.168.1.180/time?v=240
  nab_time_zone_430: curl http://192.168.1.180/time?v=270
  nab_time_zone_500: curl http://192.168.1.180/time?v=300
  nab_time_zone_530: curl http://192.168.1.180/time?v=330
  nab_time_zone_545: curl http://192.168.1.180/time?v=345
  nab_time_zone_600: curl http://192.168.1.180/time?v=260
  nab_time_zone_700: curl http://192.168.1.180/time?v=420
  nab_time_zone_800: curl http://192.168.1.180/time?v=480
  nab_time_zone_900: curl http://192.168.1.180/time?v=540
  nab_time_zone_930: curl http://192.168.1.180/time?v=570
  nab_time_zone_1000: curl http://192.168.1.180/time?v=600
  nab_time_zone_1100: curl http://192.168.1.180/time?v=660
  nab_time_zone_1200: curl http://192.168.1.180/time?v=720
  nab_radio_1: curl http://192.168.1.180/play?u=http://37.247.50.30/MC2.mp3
  nab_radio_2: curl http://192.168.1.180/play?u=http://194.97.151.135/workout-hits.aac
  nab_radio_3: curl http://192.168.1.180/play?u=http://shoutcast.rtl.it:3010/stream/1/
#------------------------------------------------------------------------------
automation:
#------------------------------------------------------------------------------
  - alias: "Startup setup"
    trigger:
      - platform: homeassistant
        event: start
    action:
      - service: group.set_visibility
        entity_id: group.nabaztag_locale_setup
        data:
          visible: False
      - service: input_number.set_value
        data_template:
          entity_id: input_number.bitcoin_previous_exchange_rate
          value: "{{ states('sensor.exchange_rate_1_btc') }}"
#******************************************************************************
  - alias: "Nabaztag Sounds"
    trigger:
    - platform: state
      entity_id: input_select.nabaztag_sounds
    condition:
      condition: template
      value_template: "{{ not is_state('input_select.nabaztag_sounds', ' ') }}"
    action:
    - service_template: >
        {% if is_state("input_select.nabaztag_sounds", "Communication") %} shell_command.nab_communication
        {% elif is_state("input_select.nabaztag_sounds", "Ack") %} shell_command.nab_ack
        {% elif is_state("input_select.nabaztag_sounds", "Abort") %} shell_command.nab_abort
        {% elif is_state("input_select.nabaztag_sounds", "Ministop") %} shell_command.nab_ministop
        {% else %}
          shell_command.nab_abort
        {% endif %}
    - service: input_select.select_option
      data:
        entity_id: input_select.nabaztag_sounds
        option: " "
#******************************************************************************
  - alias: "Nabaztag Radio"
    trigger:
    - platform: state
      entity_id: input_select.nabaztag_radio
    condition:
      condition: template
      value_template: "{{ not is_state('input_text.nabaztag_radio', ' ') }}"
    action:
    - service_template: >
        {% if is_state("input_select.nabaztag_radio", "Radio 1") %} shell_command.nab_radio_1
        {% elif is_state("input_select.nabaztag_radio", "Radio 2") %} shell_command.nab_radio_2
        {% elif is_state("input_select.nabaztag_radio", "Radio 3") %} shell_command.nab_radio_3
        {% elif is_state("input_select.nabaztag_radio", "No Radio") %} shell_command.nab_abort
        {% endif %}
    - service: input_select.select_option
      data:
        entity_id: input_select.nabaztag_radio
        option: " "
#******************************************************************************
  - alias: "Nabaztag Talk"
    trigger:
    - platform: state
      entity_id: input_text.nabaztag_voice
    condition:
      condition: template
      value_template: "{{ not is_state('input_text.nabaztag_voice', ' ') }}"
    action:
    - service: script.nabaztag_talk
      data_template:
        message: "{{ states('input_text.nabaztag_voice') }}"
    - service: input_text.set_value
      data:
        entity_id: input_text.nabaztag_voice
        value: ' '
#******************************************************************************
  - alias: "Change Locale Setup"
    trigger:
    - platform: state
      entity_id: input_boolean.show_nabaztag_locales
    action:
    - service: group.set_visibility
      entity_id: group.nabaztag_locale_setup
      data_template:
        visible: >
          {% if is_state("input_boolean.show_nabaztag_locales", "on") %}
            True
          {% else %}
            False
          {% endif %}
#******************************************************************************
  - alias: "Nabaztag Taichi"
    trigger:
    - platform: state
      entity_id: input_select.nabaztag_taichi
    action:
    - service_template: >
        {%-if is_state("input_select.nabaztag_taichi", "Taichi min") %} shell_command.nab_taichi_min
        {%-elif is_state("input_select.nabaztag_taichi", "Taichi medium") %} shell_command.nab_taichi_medium
        {% elif is_state("input_select.nabaztag_taichi", "Taichi max") %} shell_command.nab_taichi_max
        {% else %}
          shell_command.nab_surprise
        {% endif %}
#******************************************************************************
  - alias: "Nabaztag Nose"
    trigger:
    - platform: state
      entity_id: input_select.nabaztag_nose
    action:
    - service_template: >
        {% if is_state("input_select.nabaztag_nose", "Todo") %} shell_command.nab_nose_2
        {% elif is_state("input_select.nabaztag_nose", "Urgent") %} shell_command.nab_nose_3
        {% elif is_state("input_select.nabaztag_nose", "Panic") %} shell_command.nab_nose_4
        {% else %}
          shell_command.nab_abort
        {% endif %}
#******************************************************************************
  - alias: "Nabaztag Left Ear"
    trigger:
    - platform: state
      entity_id: input_number.nabaztag_left_ear
    action:
    - service_template: >
        {% if is_state("input_number.nabaztag_left_ear", "0.0") %} shell_command.nab_ear_left_0
        {% elif is_state("input_number.nabaztag_left_ear", "1.0") %} shell_command.nab_ear_left_1
        {% elif is_state("input_number.nabaztag_left_ear", "2.0") %} shell_command.nab_ear_left_2
        {% elif is_state("input_number.nabaztag_left_ear", "3.0") %} shell_command.nab_ear_left_3
        {% elif is_state("input_number.nabaztag_left_ear", "4.0") %} shell_command.nab_ear_left_4
        {% elif is_state("input_number.nabaztag_left_ear", "5.0") %} shell_command.nab_ear_left_5
        {% elif is_state("input_number.nabaztag_left_ear", "6.0") %} shell_command.nab_ear_left_6
        {% elif is_state("input_number.nabaztag_left_ear", "7.0") %} shell_command.nab_ear_left_7
        {% elif is_state("input_number.nabaztag_left_ear", "8.0") %} shell_command.nab_ear_left_8
        {% elif is_state("input_number.nabaztag_left_ear", "9.0") %} shell_command.nab_ear_left_9
        {% elif is_state("input_number.nabaztag_left_ear", "10.0") %} shell_command.nab_ear_left_10
        {% elif is_state("input_number.nabaztag_left_ear", "11.0") %} shell_command.nab_ear_left_11
        {% elif is_state("input_number.nabaztag_left_ear", "12.0") %} shell_command.nab_ear_left_12
        {% elif is_state("input_number.nabaztag_left_ear", "13.0") %} shell_command.nab_ear_left_13
        {% elif is_state("input_number.nabaztag_left_ear", "14.0") %} shell_command.nab_ear_left_14
        {% elif is_state("input_number.nabaztag_left_ear", "15.0") %} shell_command.nab_ear_left_15
        {% elif is_state("input_number.nabaztag_left_ear", "16.0") %} shell_command.nab_ear_left_16
        {% else %}
          shell_command.nab_abort
        {% endif %}
#******************************************************************************
  - alias: "Nabaztag Right Ear"
    trigger:
    - platform: state
      entity_id: input_number.nabaztag_right_ear
    action:
    - service_template: >
        {% if is_state("input_number.nabaztag_right_ear", "0.0") %} shell_command.nab_ear_right_0
        {% elif is_state("input_number.nabaztag_right_ear", "1.0") %} shell_command.nab_ear_right_1
        {% elif is_state("input_number.nabaztag_right_ear", "2.0") %} shell_command.nab_ear_right_2
        {% elif is_state("input_number.nabaztag_right_ear", "3.0") %} shell_command.nab_ear_right_3
        {% elif is_state("input_number.nabaztag_right_ear", "4.0") %} shell_command.nab_ear_right_4
        {% elif is_state("input_number.nabaztag_right_ear", "5.0") %} shell_command.nab_ear_right_5
        {% elif is_state("input_number.nabaztag_right_ear", "6.0") %} shell_command.nab_ear_right_6
        {% elif is_state("input_number.nabaztag_right_ear", "7.0") %} shell_command.nab_ear_right_7
        {% elif is_state("input_number.nabaztag_right_ear", "8.0") %} shell_command.nab_ear_right_8
        {% elif is_state("input_number.nabaztag_right_ear", "9.0") %} shell_command.nab_ear_right_9
        {% elif is_state("input_number.nabaztag_right_ear", "10.0") %} shell_command.nab_ear_right_10
        {% elif is_state("input_number.nabaztag_right_ear", "11.0") %} shell_command.nab_ear_right_11
        {% elif is_state("input_number.nabaztag_right_ear", "12.0") %} shell_command.nab_ear_right_12
        {% elif is_state("input_number.nabaztag_right_ear", "13.0") %} shell_command.nab_ear_right_13
        {% elif is_state("input_number.nabaztag_right_ear", "14.0") %} shell_command.nab_ear_right_14
        {% elif is_state("input_number.nabaztag_right_ear", "15.0") %} shell_command.nab_ear_right_15
        {% elif is_state("input_number.nabaztag_right_ear", "16.0") %} shell_command.nab_ear_right_16
        {% else %}
          shell_command.nab_abort
        {% endif %}
#******************************************************************************
  - alias: "Nabaztag Body Language"
    trigger:
    - platform: state
      entity_id: input_select.nabaztag_body_language
    action:
    - service: input_number.set_value
      data_template:
        entity_id: input_number.nabaztag_left_ear
        value: >
          {% if is_state("input_select.nabaztag_body_language", "Listening") %} 2.0
          {% elif is_state("input_select.nabaztag_body_language", "Curious") %} 16.0
          {% elif is_state("input_select.nabaztag_body_language", "Crazy") %} 3.0
          {% elif is_state("input_select.nabaztag_body_language", "Scared") %} 14.0
          {% elif is_state("input_select.nabaztag_body_language", "Sad") %} 11.0
          {% elif is_state("input_select.nabaztag_body_language", "Up") %} 0.0
          {% elif is_state("input_select.nabaztag_body_language", "Down") %} 10.0
          {% elif is_state("input_select.nabaztag_body_language", "Left") %} 11.0
          {% elif is_state("input_select.nabaztag_body_language", "Right") %} 0.0
          {% endif %}
    - service: input_number.set_value
      data_template:
        entity_id: input_number.nabaztag_right_ear
        value: >
          {% if is_state("input_select.nabaztag_body_language", "Listening") %} 2.0
          {% elif is_state("input_select.nabaztag_body_language", "Curious") %} 2.0
          {% elif is_state("input_select.nabaztag_body_language", "Crazy") %} 14.0
          {% elif is_state("input_select.nabaztag_body_language", "Scared") %} 14.0
          {% elif is_state("input_select.nabaztag_body_language", "Sad") %} 11.0
          {% elif is_state("input_select.nabaztag_body_language", "Up") %} 0.0
          {% elif is_state("input_select.nabaztag_body_language", "Down") %} 10.0
          {% elif is_state("input_select.nabaztag_body_language", "Left") %} 0.0
          {% elif is_state("input_select.nabaztag_body_language", "Right") %} 11.0
          {% endif %}
#******************************************************************************
  - alias: "Nabaztag Weather"
    trigger:
    - platform: state
      entity_id: input_select.nabaztag_weather
    action:
    - service_template: >
        {% if is_state("input_select.nabaztag_weather", "Sun") %} shell_command.nab_weather_0
        {% elif is_state("input_select.nabaztag_weather", "Clouds") %} shell_command.nab_weather_1
        {% elif is_state("input_select.nabaztag_weather", "Fog") %} shell_command.nab_weather_2
        {% elif is_state("input_select.nabaztag_weather", "Rain") %} shell_command.nab_weather_3
        {% elif is_state("input_select.nabaztag_weather", "Snow") %} shell_command.nab_weather_4
        {% elif is_state("input_select.nabaztag_weather", "Storm") %} shell_command.nab_weather_5
        {% else %}
          shell_command.nab_abort
        {% endif %}
#******************************************************************************
  - alias: "Nabaztag Darksky Weather"
    trigger:
    - platform: state
      entity_id: sensor.dark_sky_icon
    - platform: state
      entity_id: input_select.nabaztag_show_info
    condition:
    - condition: state
      entity_id: 'input_select.nabaztag_show_info'
      state: 'Weather'
    action:
    - service: shell_command.nab_clear
    - service_template: >
        {% if is_state("sensor.dark_sky_icon", "clear-day") %} shell_command.nab_weather_0
        {% elif is_state("sensor.dark_sky_icon", "clear-night") %} shell_command.nab_weather_0
        {% elif is_state("sensor.dark_sky_icon", "cloudy") %} shell_command.nab_weather_1
        {% elif is_state("sensor.dark_sky_icon", "partly-cloudy-day") %} shell_command.nab_weather_1
        {% elif is_state("sensor.dark_sky_icon", "partly-cloudy-night") %} shell_command.nab_weather_1
        {% elif is_state("sensor.dark_sky_icon", "fog") %} shell_command.nab_weather_2
        {% elif is_state("sensor.dark_sky_icon", "rain") %} shell_command.nab_weather_3
        {% elif is_state("sensor.dark_sky_icon", "sleet") %} shell_command.nab_weather_4
        {% elif is_state("sensor.dark_sky_icon", "snow") %} shell_command.nab_weather_4
        {% elif is_state("sensor.dark_sky_icon", "wind") %} shell_command.nab_weather_5
        {% elif is_state("sensor.dark_sky_icon", "hail") %} shell_command.nab_weather_5
        {% elif is_state("sensor.dark_sky_icon", "thunderstorm") %} shell_command.nab_weather_5
        {% elif is_state("sensor.dark_sky_icon", "tornado") %} shell_command.nab_weather_5
        {% else %}
          script.nabaztag_info_off
        {% endif %}
    - service: input_select.select_option
      entity_id: input_select.nabaztag_body_language
      data_template:
        option: >
          {% if is_state("sensor.dark_sky_icon", "clear-day") %}Up
          {% elif is_state("sensor.dark_sky_icon", "clear-night") %}Up
          {% elif is_state("sensor.dark_sky_icon", "cloudy") %}Sad
          {% elif is_state("sensor.dark_sky_icon", "partly-cloudy-day") %}Curious
          {% elif is_state("sensor.dark_sky_icon", "partly-cloudy-night") %}Curious
          {% elif is_state("sensor.dark_sky_icon", "fog") %}Down
          {% elif is_state("sensor.dark_sky_icon", "rain") %}Down
          {% elif is_state("sensor.dark_sky_icon", "sleet") %}Listening
          {% elif is_state("sensor.dark_sky_icon", "snow") %}Listening
          {% elif is_state("sensor.dark_sky_icon", "wind") %}Scared
          {% elif is_state("sensor.dark_sky_icon", "hail") %}Scared
          {% elif is_state("sensor.dark_sky_icon", "thunderstorm") %}Scared
          {% elif is_state("sensor.dark_sky_icon", "tornado") %}Scared
          {% else %}Crazy
          {% endif %}
#******************************************************************************
  - alias: "Nabaztag Stock"
    trigger:
    - platform: state
      entity_id: input_select.nabaztag_stock
    action:
    - service_template: >
        {% if is_state("input_select.nabaztag_stock", "---") %} shell_command.nab_stock_0
        {% elif is_state("input_select.nabaztag_stock", "--") %} shell_command.nab_stock_1
        {% elif is_state("input_select.nabaztag_stock", "-") %} shell_command.nab_stock_2
        {% elif is_state("input_select.nabaztag_stock", "0") %} shell_command.nab_stock_3
        {% elif is_state("input_select.nabaztag_stock", "+") %} shell_command.nab_stock_4
        {% elif is_state("input_select.nabaztag_stock", "++") %} shell_command.nab_stock_5
        {% elif is_state("input_select.nabaztag_stock", "+++") %} shell_command.nab_stock_6
        {% else %}
          shell_command.nab_abort
        {% endif %}
#******************************************************************************
  - alias: "Nabaztag Bitcoin Difference"
    trigger:
    - platform: state
      entity_id: sensor.timestamp
    action:
    - service: input_number.set_value
      data_template:
        entity_id: input_number.bitcoin_value_difference
        value: "{{ ( states('sensor.exchange_rate_1_btc') | float ) - ( states('input_number.bitcoin_previous_exchange_rate') | float ) }}"
    - service: input_number.set_value
      data_template:
        entity_id: input_number.bitcoin_previous_exchange_rate
        value: "{{ states('sensor.exchange_rate_1_btc') }}"
#******************************************************************************
  - alias: "Nabaztag Bitcoin Exchange"
    trigger:
    - platform: state
      entity_id: input_number.bitcoin_value_difference
    - platform: state
      entity_id: input_select.nabaztag_show_info
    condition:
    - condition: state
      entity_id: 'input_select.nabaztag_show_info'
      state: 'Stocks'
    - condition: template
      value_template: "{{ not is_state('input_number.bitcoin_value_difference', '0.0') }}"
    action:
    - service: shell_command.nab_clear
    - service_template: >
        {% if states('input_number.bitcoin_value_difference') | float < -100 %} shell_command.nab_stock_0
        {% elif states('input_number.bitcoin_value_difference') | float < -50 %} shell_command.nab_stock_1
        {% elif states('input_number.bitcoin_value_difference') | float < -5 %} shell_command.nab_stock_2
        {% elif states('input_number.bitcoin_value_difference') | float > 5 %} shell_command.nab_stock_4
        {% elif states('input_number.bitcoin_value_difference') | float > 50 %} shell_command.nab_stock_5
        {% elif states('input_number.bitcoin_value_difference') | float > 100 %} shell_command.nab_stock_6
        {% else %}
          shell_command.nab_stock_3
        {% endif %}
    - service: input_select.select_option
      entity_id: input_select.nabaztag_body_language
      data_template:
        option: >
          {% if states('input_number.bitcoin_value_difference') | float < -100 %}Crazy
          {% elif states('input_number.bitcoin_value_difference') | float < -50 %}Left
          {% elif states('input_number.bitcoin_value_difference') | float < -5 %}Left
          {% elif states('input_number.bitcoin_value_difference') | float > 5 %}Right
          {% elif states('input_number.bitcoin_value_difference') | float > 50 %}Right
          {% elif states('input_number.bitcoin_value_difference') | float > 100 %}Crazy
          {% else %}Up
          {% endif %}
#******************************************************************************
  - alias: "Nabaztag Traffic"
    trigger:
    - platform: state
      entity_id: input_select.nabaztag_traffic
    action:
    - service_template: >
        {% if is_state("input_select.nabaztag_traffic", "Free") %} shell_command.nab_traffic_0
        {% elif is_state("input_select.nabaztag_traffic", "Okay") %} shell_command.nab_traffic_1
        {% elif is_state("input_select.nabaztag_traffic", "Moderate") %} shell_command.nab_traffic_2
        {% elif is_state("input_select.nabaztag_traffic", "Normal") %} shell_command.nab_traffic_3
        {% elif is_state("input_select.nabaztag_traffic", "Heavy") %} shell_command.nab_traffic_4
        {% elif is_state("input_select.nabaztag_traffic", "Congested") %} shell_command.nab_traffic_5
        {% elif is_state("input_select.nabaztag_traffic", "Extreme") %} shell_command.nab_traffic_6
        {% else %}
          shell_command.nab_abort
        {% endif %}
#******************************************************************************
  - alias: "Nabaztag Google Traffic"
    trigger:
    - platform: state
      entity_id: sensor.home_to_work
    - platform: state
      entity_id: input_select.nabaztag_show_info
    condition:
    - condition: state
      entity_id: 'input_select.nabaztag_show_info'
      state: 'Traffic'
    action:
    - service: shell_command.nab_clear
    - service_template: >
        {% if is_state("sensor.traffic_status", "OK") %} shell_command.nab_traffic_0
        {% elif is_state("sensor.traffic_status", "OK") %} shell_command.nab_traffic_1
        {% endif %}
#******************************************************************************
  - alias: "Nabaztag Pollution"
    trigger:
    - platform: state
      entity_id: input_select.nabaztag_pollution
    action:
    - service_template: >
        {% if is_state("input_select.nabaztag_pollution", "0") %} shell_command.nab_pollution_0
        {% elif is_state("input_select.nabaztag_pollution", "1") %} shell_command.nab_pollution_1
        {% elif is_state("input_select.nabaztag_pollution", "2") %} shell_command.nab_pollution_2
        {% elif is_state("input_select.nabaztag_pollution", "3") %} shell_command.nab_pollution_3
        {% elif is_state("input_select.nabaztag_pollution", "4") %} shell_command.nab_pollution_4
        {% elif is_state("input_select.nabaztag_pollution", "5") %} shell_command.nab_pollution_5
        {% elif is_state("input_select.nabaztag_pollution", "6") %} shell_command.nab_pollution_6
        {% elif is_state("input_select.nabaztag_pollution", "7") %} shell_command.nab_pollution_7
        {% elif is_state("input_select.nabaztag_pollution", "8") %} shell_command.nab_pollution_8
        {% elif is_state("input_select.nabaztag_pollution", "9") %} shell_command.nab_pollution_9
        {% elif is_state("input_select.nabaztag_pollution", "10") %} shell_command.nab_pollution_10
        {% else %}
          shell_command.nab_abort
        {% endif %}
#******************************************************************************
  - alias: "Nabaztag Airvisual Pollution"
    trigger:
    - platform: state
      entity_id: sensor.us_air_quality_index
    - platform: state
      entity_id: input_select.nabaztag_show_info
    condition:
    - condition: state
      entity_id: 'input_select.nabaztag_show_info'
      state: 'Pollution'
    action:
    - service: shell_command.nab_clear
    - service_template: >
        {% if states('sensor.us_air_quality_index') > 300 %} shell_command.nab_pollution_10
        {% elif states('sensor.us_air_quality_index') > 270 %} shell_command.nab_pollution_9
        {% elif states('sensor.us_air_quality_index') > 240 %} shell_command.nab_pollution_8
        {% elif states('sensor.us_air_quality_index') > 210 %} shell_command.nab_pollution_7
        {% elif states('sensor.us_air_quality_index') > 180 %} shell_command.nab_pollution_6
        {% elif states('sensor.us_air_quality_index') > 150 %} shell_command.nab_pollution_5
        {% elif states('sensor.us_air_quality_index') > 120 %} shell_command.nab_pollution_4
        {% elif states('sensor.us_air_quality_index') > 90 %} shell_command.nab_pollution_3
        {% elif states('sensor.us_air_quality_index') > 60 %} shell_command.nab_pollution_2
        {% elif states('sensor.us_air_quality_index') > 30 %} shell_command.nab_pollution_1
        {% elif states('sensor.us_air_quality_index') < 30 %} shell_command.nab_pollution_0
        {% endif %}
    - service: input_select.select_option
      entity_id: input_select.nabaztag_body_language
      data_template:
        option: >
          {% if states('sensor.us_air_quality_index') 300 %}Crazy
          {% elif states('sensor.us_air_quality_index') > 270 %}Sad
          {% elif states('sensor.us_air_quality_index') > 240 %}Sad
          {% elif states('sensor.us_air_quality_index') > 210 %}Scared
          {% elif states('sensor.us_air_quality_index') > 180 %}Scared
          {% elif states('sensor.us_air_quality_index') > 150 %}Curious
          {% elif states('sensor.us_air_quality_index') > 120 %}Curious
          {% elif states('sensor.us_air_quality_index') > 90 %}Listening
          {% elif states('sensor.us_air_quality_index') > 60 %}Listening
          {% elif states('sensor.us_air_quality_index') > 30 %}Up
          {% elif states('sensor.us_air_quality_index') < 30 %}Up
          {% endif %}
#******************************************************************************
  - alias: "Nabaztag Language"
    trigger:
    - platform: state
      entity_id: input_select.nabaztag_language
    action:
    - service_template: >
        {% if is_state("input_select.nabaztag_language", "English") %} shell_command.nab_lang_uk
        {%-elif is_state("input_select.nabaztag_language", "Italian") %} shell_command.nab_lang_it
        {%-elif is_state("input_select.nabaztag_language", "French") %} shell_command.nab_lang_fr
        {%-elif is_state("input_select.nabaztag_language", "Spanish") %} shell_command.nab_lang_es
        {% else %}
          shell_command.nab_surprise
        {% endif %}
#******************************************************************************
  - alias: "Nabaztag Time Zone"
    trigger:
    - platform: state
      entity_id: input_select.nabaztag_time_zone
    action:
    - service_template: >
        {% if is_state("input_select.nabaztag_time_zone", "GMT -12:00") %} shell_command.nab_time_zone_B1200
        {% elif is_state("input_select.nabaztag_time_zone", "GMT -11:00") %} shell_command.nab_time_zone_B1100
        {% elif is_state("input_select.nabaztag_time_zone", "GMT -10:00") %} shell_command.nab_time_zone_B1000
        {% elif is_state("input_select.nabaztag_time_zone", "GMT -9:00") %} shell_command.nab_time_zone_B900
        {% elif is_state("input_select.nabaztag_time_zone", "GMT -8:00") %} shell_command.nab_time_zone_B800
        {% elif is_state("input_select.nabaztag_time_zone", "GMT -7:00") %} shell_command.nab_time_zone_B700
        {% elif is_state("input_select.nabaztag_time_zone", "GMT -6:00") %} shell_command.nab_time_zone_B600
        {% elif is_state("input_select.nabaztag_time_zone", "GMT -5:00") %} shell_command.nab_time_zone_B500
        {% elif is_state("input_select.nabaztag_time_zone", "GMT -4:00") %} shell_command.nab_time_zone_B400
        {% elif is_state("input_select.nabaztag_time_zone", "GMT -3:30") %} shell_command.nab_time_zone_B330
        {% elif is_state("input_select.nabaztag_time_zone", "GMT -3:00") %} shell_command.nab_time_zone_B300
        {% elif is_state("input_select.nabaztag_time_zone", "GMT -2:00") %} shell_command.nab_time_zone_B200
        {% elif is_state("input_select.nabaztag_time_zone", "GMT -1:00") %} shell_command.nab_time_zone_B100
        {% elif is_state("input_select.nabaztag_time_zone", "GMT") %} shell_command.nab_time_zone_0
        {% elif is_state("input_select.nabaztag_time_zone", "GMT +1:00") %} shell_command.nab_time_zone_100
        {% elif is_state("input_select.nabaztag_time_zone", "GMT +2:00") %} shell_command.nab_time_zone_200
        {% elif is_state("input_select.nabaztag_time_zone", "GMT +3:00") %} shell_command.nab_time_zone_300
        {% elif is_state("input_select.nabaztag_time_zone", "GMT +3:30") %} shell_command.nab_time_zone_330
        {% elif is_state("input_select.nabaztag_time_zone", "GMT +4:00") %} shell_command.nab_time_zone_400
        {% elif is_state("input_select.nabaztag_time_zone", "GMT +4:30") %} shell_command.nab_time_zone_430
        {% elif is_state("input_select.nabaztag_time_zone", "GMT +5:00") %} shell_command.nab_time_zone_500
        {% elif is_state("input_select.nabaztag_time_zone", "GMT +5:30") %} shell_command.nab_time_zone_530
        {% elif is_state("input_select.nabaztag_time_zone", "GMT +5:45") %} shell_command.nab_time_zone_545
        {% elif is_state("input_select.nabaztag_time_zone", "GMT +6:00") %} shell_command.nab_time_zone_600
        {% elif is_state("input_select.nabaztag_time_zone", "GMT +7:00") %} shell_command.nab_time_zone_700
        {% elif is_state("input_select.nabaztag_time_zone", "GMT +8:00") %} shell_command.nab_time_zone_800
        {% elif is_state("input_select.nabaztag_time_zone", "GMT +9:00") %} shell_command.nab_time_zone_900
        {% elif is_state("input_select.nabaztag_time_zone", "GMT +9:30") %} shell_command.nab_time_zone_930
        {% elif is_state("input_select.nabaztag_time_zone", "GMT +10:00") %} shell_command.nab_time_zone_1000
        {% elif is_state("input_select.nabaztag_time_zone", "GMT +11:00") %} shell_command.nab_time_zone_1100
        {% elif is_state("input_select.nabaztag_time_zone", "GMT +12:00") %} shell_command.nab_time_zone_1200
        {% else %}
          shell_command.nab_abort
        {% endif %}
#******************************************************************************
  - alias: "Wake up time for the Nabaztag"
    trigger:
    - platform: time
      at: '7:30:00'
    - platform: time
      at: '11:59:00'
    - platform: time
      at: '16:59:00'
    action:
    - service: switch.turn_on
      entity_id: switch.nabaztaglife
    - delay:
          seconds: 5
    - service: script.nabaztag_talk
      data:
        message: "Buongiorno mondo!"
#******************************************************************************
  - alias: "Sleep time for the Nabaztag during the day"
    trigger:
    - platform: time
      at: '8:00:00'
    - platform: time
      at: '13:40:00'
    condition:
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    action:
    - service: script.nabaztag_talk
      data:
        message: "Credo che mi far√≤ un riposino."
    - delay:
          seconds: 5
    - service: switch.turn_off
      entity_id: switch.nabaztaglife  
#******************************************************************************
  - alias: "Sleep time for the Nabaztag during the night"
    trigger:
    - platform: time
      at: '23:30:00'
    action:
    - service: script.nabaztag_talk
      data:
        message: "Buonanotte a tutti."
    - delay:
          seconds: 5
    - service: switch.turn_off
      entity_id: switch.nabaztaglife
#******************************************************************************